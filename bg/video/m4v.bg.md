{
  "date" : "2019-10-11",
  "keywords" :[ "M4V", "файл", "разширение", "формат", "MPEG-4", "Управление на цифрови права", "DRM", "Apple", "видео"],
  "author" : {
    "display_name" : "Kashif Iqbal"
},
  "draft" : "false",
  "toc" : true,
  "title" :"M4V",
  "description":"Научете за файловия формат M4V и API, които могат да създават и отварят M4V файлове.",
  "linktitle" : "M4V",
  "menu" : {
    "docs" : {
      "parent" : "video"
}
},
  "lastmod" : "2019-09-14"
}

## Какво е M4V файл?

Файловият формат **M4V**, разработен от Apple, е видеоконтейнер, опционално защитен със защита срещу копиране за управление на цифровите права (DRM) за защита на поверителността или копирането. Видеоклиповете и аудиозаписите се обвиват от контейнерни файлове за индексиране и организиране на потоци за възпроизвеждане. Освен това контейнерите предоставят функцията на глави, подобни на тези на DVD. Apple използва M4V за кодиране на видеоклипове в своя iTunes Store. Той защитава неоторизирано възпроизвеждане чрез защитата срещу копиране FairPlay на Apple, като позволява възпроизвеждането на M4V файлове само на оторизирани компютри, които имат акаунтите, използвани за закупуване на видеоклипа. Въпреки това, ако DRM-защитата е премахната от M4V файлове, тези файлове могат да се възпроизвеждат в други видео плейъри чрез промяна на разширението от .m4v на .mp4, поради което M4V файловете са свързани с MPEG-4. M4V използва H.264 за видео и **[AAC](/bg/audio/aac/)** и Dolby Digital за аудио кодиране и декодиране.

## M4V файлова структура ##

M4V файловете имат непрекъснати парчета с 8 байта заглавие, 4 байта размер на парче и 4 байта тип парче във всяко парче. Първата част е „ftype“ и има подтип при отместване 8. M4V, дефиниран от подтип, който трябва да бъде „M4V_“. Допълнителни типове парчета са предварително дефинирани подписи: "ftyp", "mdat", "moov", "pnot", "udta", "uuid", "moof", "free", "skip", "jP2 ", "wide" , "load", "ctab", "imap", "matt", "kmat", "clip", "crgn", "sync", "chap", "tmcd", "scpt", "ssrc", " СНИМКА“. Итерирайки парчета, докато не бъде открит неизвестен тип, съставяме M4V файл.

Ето преглед на проба: Примерни двоични данни на m4v файл се проверяват чрез Hex Viewer и може да се види, че започва със сигнатура **ftyp** (hex: 66 74 79 70) при отместване 4, което дефинира QuickTime Тип контейнерен файл. Подтипът на файла е **M4V_** (шестнадесетичен: 4D 34 56 20), което сочи към файлов тип M4V (MPEG-4). Размерът на първия блок е 32 (шестнадесетичен: 00 00 00 20, голям порядък, първи старши байт), размерът се намира при отместване 0. При отместване 32 (шестнадесетичен: 20) се намира втората част, която има размер 30 322 (шестнадесетичен : 00 00 76 72, голям порядък, първо по-нисък байт) и въведете **moov** (шестнадесетичен: 6D 6F 6F 76). Следващата част се намира на отместване 32+30,322#30,354 (шестнадесетичен: 00 00 76 92) и има размер 8 (шестнадесетичен: 00 00 00 08) и тип **свободен** (шестнадесетичен: 66 72 65 65).
### Кодеци, използвани в M4V ###

#### Видео кодек H.264 ####

H.264 е стандарт за видео компресия, който преобразува цифрово видео във формат, който изисква по-малко място, когато е необходимо предаване или съхранение. M4V използва H.264 за видео компресия. Приложението му варира от DVD, телевизия, видеоконференции и поточно видео по интернет. H.264 се състои от две основни части: енкодер – който компресира видеото, декодер – който декомпресира обратно компресираното видео. На фигурата по-долу процесите на кодиране и декодиране са подчертани, а други процеси са обхванати от стандарта H.264.

##### Процес на кодиране и декодиране на видео в H.264 #####

За компресирания битов поток H.264 видео енкодерът извършва процеса на прогнозиране, трансформация и кодиране. В същото време декодерът извършва обратния процес на декодиране, обратна трансформация и реконструкция, за да произведе обратно видео файла. H.264 заема половината от размера на MPEG.

#### Аудио кодек ####

Advanced Audio Coding (AAC) е аудио кодек за цифрово аудио компресиране със загуби и се използва в M4V контейнер. AAC е наследник на формата [MP3](/bg/audio/mp3/) и постига по-добро качество от MP3 със същия битрейт. AAC форматът изхвърля част от информацията по време на процеса на компресиране, която е от по-малко значение. AAC е базиран на блок кодек с променлива битрейт (VBR), където всеки блок декодира до 1024 семпли във времева област.

### Препратки ###

* [Уикипедия - M4V](https://en.wikipedia.org/wiki/M4V)
* [Уикипедия - MPEG-4_AVC](https://en.wikipedia.org/wiki/H.264/MPEG-4_AVC)

