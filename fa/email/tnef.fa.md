{
  "date": "2019-10-11",
  "author": {
    "display_name": "Kashif Iqbal"
}،
  "draft": "false",
  "toc": true,
  "title": "TNEF",
  "description": "با فرمت فایل TNEF و APIهایی که می توانند فایل های TNEF را ایجاد و باز کنند آشنا شوید.",
  "linktitle": "TNEF",
  "menu": {
    "docs": {
      "parent": "email",
      "identifier": "email-tne-faf"
}
}،
  "lastmod": "2019-09-10"
}

## فایل TNEF چیست؟

فرمت محفظه خنثی حمل و نقل (TNEF) یک فرمت اختصاصی مایکروسافت است که برای کپسوله کردن پیوست های ایمیل بر اساس رابط برنامه نویسی برنامه پیام رسانی (**MAPI**) است. Microsoft Outlook و Microsoft Exchange Server به طور کامل از TNEF پشتیبانی می کنند در حالی که بعداً TNEF را به MAPI رمزگشایی می کند و نامه های فرمت شده را نمایش می دهد. یک پیوست ایمیل با رمزگذاری TNEF دارای نوع MIME MS-TNEF است و به صورت winmail/win.dat ذخیره می شود. پیوست در winmail .dat اطلاعات زیر را در بر می گیرد:


|پیام|اشیاء OLE|ویژگی های Outlook
---|---|---|
|<ul style=;text-align:right;direction:rtl><li style=;text-align:right;direction:rtl> پیوست های پیام اصلی</li><li style=;text-align:right;direction:rtl> نسخه اصلی فرمت شده</li><li style=;text-align:right;direction:rtl> فونت، اندازه متن و رنگ متن</li></ul> |<ul style=;text-align:right;direction:rtl><li style=;text-align:right;direction:rtl> تصاویر تعبیه شده</li><li style=;text-align:right;direction:rtl> اسناد آفیس تعبیه شده</li></ul> |<ul style=;text-align:right;direction:rtl><li style=;text-align:right;direction:rtl> فرم های سفارشی</li><li style=;text-align:right;direction:rtl> دکمه های رای گیری</li><li style=;text-align:right;direction:rtl> درخواست های ملاقات</li></ul>


سایر سرویس‌های ایمیلی که از TNEF پشتیبانی نمی‌کنند، متن ساده را برای پیام‌های قالب‌بندی شده TNEF ارائه می‌کنند. Outlook یک قالب غنی از پیام را در فایل های TNEF (OLE) یا ویژگی های خاص Outlook (فرم ها، دکمه های نظرسنجی و درخواست های کنفرانس) جاسازی می کند. تحریم کدگذاری صریح TNEF در سرویس گیرنده ایمیل Outlook امکان پذیر نیست، با این حال، انتخاب فرمت RTF برای ارسال یک ایمیل به طور ضمنی رمزگذاری TNEF را تسهیل می کند.

## فرمت فایل TNEF

الگوریتم داده TNEF یک ساختار مسطح از ویژگی های پیام سلسله مراتبی غنی ایجاد می کند. سپس از این ساختارهای مسطح برای نمایش یک جریان داده سریالی متشکل از ویژگی های خاص استفاده می شود.

در برخی موقعیت‌ها، جایی که ویژگی‌ها در گروه‌ها یا دارای چندین مقدار هستند، جریان ممکن است شامل شمارش‌ها و بالشتک‌ها برای اعمال ترازهای داده خاص باشد. یک موقعیت متمایز که در آن استفاده از این الگوریتم سودمند است، در یک محیط پیام رسانی غیرحمایت کننده است. در چنین محیط‌هایی، یک ویژگی پیام غنی توسط یک TNEF Writer در یک جریان داده سریال کدگذاری می‌شود. علاوه بر این، ویژگی هایی که به TNEF زیرین تعلق ندارند، می توانند در حین انتقال محصور شوند. سپس این ویژگی‌های محصور شده با رمزگشایی از طریق یک TNEF برای اطمینان از در دسترس بودن همه ویژگی‌های پیام اصلی برای برنامه مشتری در دسترس قرار می‌گیرند.

در TNEF همه انواع داده های عددی کمی اندین هستند و اندازه آنها بیشتر از یک بایت است. مدیریت این مقادیر عددی بر روی پلتفرم‌های غیرکوچک نیازمند انجام تبدیل‌های مناسب برای بدست آوردن مقادیر صحیح است. مقادیر رشته در فرمت ABNF (Augmented Backus-Naur Form) با توجه به مشخصات [RFC5234] نشان داده شده است. هنگامی که رشته با کاراکتر تهی خاتمه می یابد، همچنین شامل می شود. برای مثال، worker@specimen.com %x00.

{{< figure src="../TNEF.png" alt="فرمت فایل TNEF" >}}

## ویژگی های TNEF و قوانین پردازش ##

جریان داده در TNEF با یک شماره نسخه قدیمی، یک امضا، یک مقدار کلید اولیه و یک صفت نشان دهنده صفحه کد شروع می شود. این صفحه کد زمانی ایجاد می شود که رمزگذار ویژگی ها و ویژگی های ANSI را ثبت می کند. پس از آن، جریان به مجموعه‌ای از ویژگی‌ها تبدیل شد که در آن ویژگی‌های پیام ابتدا ردیف می‌شوند و سپس ویژگی‌های پیوست دنبال می‌شوند. ویژگی های مختلف پیام و پیوست در ویژگی های خاصی مانند attMsgProps، attAttachment و attRecipTable موجود است. ویژگی هایی که در جریان TNEF ظاهر می شوند، شامل ساختار، ویژگی های پیام و تبدیل های لازم برای درگیر شدن آنها با ویژگی های پیام هستند. هر مشخصه از یک شناسه، اندازه و داده های مشخصه، یک جمع کنترل و یک سطح بر اساس کاربرد آن تشکیل شده است.

## ارتباط با پروتکل ها و سایر الگوریتم ها ##

سیستم هایی که مکانیسم ضعیفی برای نمایش فرمت پیام غنی دارند به صورت بومی به الگوریتم داده TNEF برای انتقال نیاز دارند. با استفاده از نوع رسانه ms-TNEF، خروجی الگوریتم شامل یک فایل پیوست (winmail.dat) و بخشی از بدنه MIME است که در [RFC2045] مشخص شده است. متن پیام متنی ساده با استفاده از UUENCODE مطابق مشخصات [MSDN-UAF] منتقل می شود و این متن پیام یا روش معادل آن در انتهای گیرنده رمزگشایی می شود. علاوه بر این، TNEF می‌تواند داده‌های پیام را با استفاده از پروتکل‌های مختلف اینترنتی مانند SMTP، POP3، IMAP4 و پروتکل‌هایی که MIME را مطابق استاندارد RFC2045 ادغام می‌کنند، انتقال دهد.

## بیانیه کاربردی ##

علاوه بر انتقال پیام ساده، برنامه اصلی TNEF برای استفاده از کلاس‌های پیام و پشتیبانی از ویژگی‌های اضافی که هیچ پشتیبانی اصلی در پروتکل انتقال ندارند ایجاد می‌شد. این نرم افزار بیشتر برای انتقال ویژگی های پیام غنی و ویژگی های نامگذاری شده است که مشتریان پیام رسانی مدرن امروزه از آنها استفاده می کنند. برای انطباق با پیاده سازی اصلی، نحو ویژگی اصلی حفظ می شود و یک ویژگی خاص ویژگی های پیام جدید را جداگانه نگه می دارد.

## منابع

* [قالب محفظه خنثی حمل و نقل](https://en.wikipedia.org/wiki/Transport_Neutral_Encapsulation_Format)

* [آدرس های ایمیل و دفترچه های آدرس در Exchange Server](https://learn.microsoft.com/en-us/exchange/email-addresses-and-address-books/email-addresses-and-address-books?view# exchserver-2019)

* [[MS-OXTNEF]: الگوریتم داده قالب خنثی کپسوله‌سازی انتقال (TNEF)](https://msdn.microsoft.com/en-us/library/cc425498(v#exchg.80).aspx)


