{
  "date" : "2019-10-11",
  "keywords" :["psb 文件","psb 文件格式","什么是 psb 文件","文件","psb 示例","psb 文件扩展名","扩展名","格式"],
  "author" : {
    "display_name" : "Kashif Iqbal"
},
  "draft" : "false",
  "toc" : true,
  "title" :"PSB - Photoshop 大图像文件格式",
  "description":"了解 PSB 文件格式和可以创建和打开 PSB 文件的 API。",
  "linktitle" : "PSB",
  "menu" : {
    "docs" : {
      "parent" : "image"
}
},
  "lastmod" : "2019-09-10"
}

## 什么是一 .psb 文件？
Adobe Photoshop 以两种格式保存文件。大小为 30,000 x 30,000 像素的文件使用 PSD 扩展名保存，大于 PSD 的文件（不超过 300,000 x 300,000 像素）使用称为“Photoshop Big"的 PSB 扩展名保存。更具体地说，PSB 文件可以大到 4 EB（超过 42 亿 GB），图像的高度和宽度高达 300,000 像素。另一方面，PSD 最大可达 2 GB，图像尺寸为 30,000 像素。

PSB 也称为 Photoshop 大格式，支持所有 Photoshop 功能，如图层、效果和滤镜。Photoshop 可以将 PSB 文件转换为 [PSD](/zh/image/psd/)、[JPG](/zh/image/jpeg/) 、[PNG](/zh/image/png/)、[EPS](/zh/page-description-language/eps/)、[GIF](/zh/image/gif/)等格式。启用 Photoshop 首选项对话框的文件处理窗格功能后，即可使用 Photoshop 大文档格式。

## 文件格式信息##

Photoshop 文件格式分为五个主要部分，其中有许多长度标记可在部分之间移动。

|文件格式
---|
|文件头
|色彩模式数据
|图片资源
|图层和蒙版信息
|(((
图像数据
)))

### 文件头###

文件头固定长度为 26 字节，包含图像的基本属性。

BYTE 签名 [4] – 等于“8BPS"。

WORD 版本 [2] – 版本号，PSD #1，PSB #2。

BYTE Reserved [6] – 保留且始终为零。

WORD Channels [2] – 图像中颜色通道的数量，包括 Alpha 通道。其值范围为 1 到 56。

LONG Rows [4] – 图像的高度（以像素为单位），PSD 1-30,000，PSB 1-300,000。

LONG Columns [4] – 图像宽度（以像素为单位），PSD 1-30,000，PSB 1-300,000。

WORD Depth [2] – 每个通道的位数。支持的值为 1、8、16 和 32。

WORD Mode [2] – 文件的颜色模式。

#### 模式说明####


|模式|说明
---|---|
|0|位图（单色）
|1|灰度
|2|已编入索引
|3|RGB
|4|CMYK
|7|多通道
|8|双色调（半色调）
|9|实验室

### 颜色模式数据###

在文件头部分之后是颜色模式数据部分。该块以一个 LONG 数字开头，该数字以字节为单位给出块的长度。颜色模式数据的结构如下：

4 个字节——以下颜色数据的长度。

变量 - 颜色数据

如果 header 部分的 mode 字段值不是 Indexed Color 或 duotone，则块的长度将为 0，并且长度字段后将没有数据。

对于索引彩色图像，长度为 768 字节，其中包含 256 个调色板。对于双色调，数据将包含屏幕参数和其他相关信息。

### 图片资源###

在色彩模式数据部分之后，第三个块是图像资源部分。前四个字节是一个 LONG 数字，指定块的长度，后跟一系列资源块。图片资源块的结构如下：

字节类型 [4] – 签名“8BIM"

WORD ID [2] – 图像资源 ID。有一个资源 ID 列表，可以从参考链接中看到。

BYTE Name [Variable] – 名称：偶数长度的 Pascal 字符串。 ** **

LONG Size [4] – 后面的资源数据的实际大小。

BYTE 数据 [变量} – 资源数据。它被填充以使尺寸均匀。

下面简要说明一些资源格式：

**网格和指南资源格式：** 网格和指南信息存储在资源块中。这些资源块包含 16 字节的网格和指南标头，后跟 5 字节的指南信息块。

**缩略图资源格式：** 缩略图信息存储在用于预览显示的图像资源块中，由 28 字节标题和 RGB 的 JFIF 缩略图组成。

**颜色采样器资源格式：** 颜色采样器信息存储在具有 8 字节标题的图像资源块中，后跟一个可变长度的颜色采样器信息块。

### 图层和蒙版信息###

第四个块是层和掩码信息块，包含关于层和掩码的信息。首先存储层信息，然后存储掩码信息。

**图层信息：** 图层信息以 LONG 值开头，显示图层信息的长度。之后有 WORD 值计数，显示要遵循的层记录数。

[8] – 层的长度

[2] – 层数

[变量] – 关于每一层的信息。

[变量] – 通道图像数据。** **

**掩码信息：**掩码结构具有以下格式：


|数据结构|字段名称|描述
---|---|---|
|字|叠加色彩空间| （未记录）
|字节[8]|颜色成分| 4x2 字节颜色分量
|字|不透明度| 0#透明，1#不透明
|字节|种类| 0#inverted, 1#protected, 128#use 存储值
|字节|填充|设置为零

### 图像数据###

最后一部分包含图像像素数据。图像数据在平面中存储为一系列序列，即首先是所有红色数据，然后是所有绿色数据等。每行开头的 WORD 显示与每条扫描线相关的字节大小。

[2] – 压缩方法：

[变量] – 平面顺序的图像数据，即 RRRR、GGGG、BBBB 等。

压缩方法：

0 – Raw 图像数据

1 – RLE 压缩

2 – 没有预测的 Zip

3 – 带预测的压缩

## 参考 ＃＃

* [PSB 文件格式 - Adobe 提供](https://www.adobe.com/devnet-apps/photoshop/fileformatashtml/)
* [PSB - 维基百科](https://en.wikipedia.org/wiki/Adobe_Photoshop#File_format)

